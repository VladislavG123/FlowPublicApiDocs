# Отправка сообщений с медиаданными

`/v1/messages`

Для отправки изображений, видео, аудио и документов корреспонденту или в группу используйте узел `messages`.

В Green API поддерживается два варианта отправки файлов:

1. [Отправка файлов через узел `media`](#media)
2. [Отправка файлов по ссылке](#link)

## 1. Отправка файлов через узел `media` {#media}
Для отправки сообщения с файлом требуется предварительно выгрузить файл в облачное хранилище `media` согласно документации [Отправка медиаданных](../media/upload.md). Поле выгрузки будет получен идентификатор файла `your-media-id`, который следует указать при отправке сообщения в поле `id`.
Используйте этот вариант отправки, если файл расположен локально на вашем сервере и недоступен из сети Интернет.

## 2. Отправка файлов по ссылке {#link}
Если файл уже опубликован в сети Интернет и доступен для скачивания по ссылке, то при отправке сообщения достаточно указать ссылку на этот файл в поле `link`. В этом случае выгружать файл в облачное хранилище `media` не требуется.

## Запрос {#request}

Для отправки изображения, видео, аудио или документа требуется выполнить запрос по адресу:
```
POST https://api.green-api.com/v1/messages
```

```json
{
    "recipient_type": "individual" | "group",
    "to": "whatsapp-id" | "whatsapp-group-id",
    "type":  "image" | "video" | "audio" | "document",

    "image": {
        "id": "your-media-id",
        "caption": "your-image-caption"
    },

    "image": {
        "link": "http(s)://the-url",
        "caption": "your-image-caption"
    },
    
    "video": {
        "id": "your-media-id"  
    },    

    "video": {
        "link": "http(s)://the-url"
    },

    "audio": {
        "id": "your-media-id"  
    },      

    "audio": {
        "link": "http(s)://the-url"
    },

    "document": {
        "id": "your-media-id",
    },

    "document": {
        "link": "http(s)://the-url",
    }
    
}
```

> Тело запроса приведено в качестве примера. В примере перечислены все возможные варианты отправки медиаданных. Тело действительного запроса может содержать только один объект медиаданных.

### Параметры запроса {#request-parameters}

Параметр | Тип | Обязательный | Описание
----- | ----- | ----- | -----
`recipient_type` | **string** | Нет | Определяет тип получателя - корреспондент или группа. Возможные значения: `individual` - отправка корреспонденту; `group` - отправка в группу. Значение по умолчанию: `individual`
`to` | **string** | Да | [Идентификатор корреспондента или группы](../chat-id.md) - получатель сообщения
`type` | **string** | Да | Тип отправляемого сообщения. При отправке сообщения с медиаданными может принимать одно из значений: `image`, `video`, `audio`, `document`
`image ` | **object** | Да, если `"type": "image"` | Объект с данными изображения
`video ` | **object** | Да, если `"type": "video"` | Объект с данными видео
`audio ` | **object** | Да, если `"type": "audio"` | Объект с данными аудио
`document ` | **object** | Да, если `"type": "document"` | Объект с данными документа

Объект `image`

Параметр | Тип | Обязательный | Описание
----- | ----- | ----- | -----
`id` | **string** | Да, если не указан `link` | Идентификатор файла изображения из облачного хранилища `media`. Файл необходимо предварительно выгрузить методом [Отправка медиаданных](../media/upload.md)
`link` | **string** | Да, если не указан `id` | Ссылка на файл изображения. Ссылка должна быть доступна из Интернет. Допускается указывать ссылки только протоколов `HTTP` и `HTTPS`
`caption` | **string** | Нет | Описание изображения. Отображается в чате под изображением

Объект `video`

Параметр | Тип | Обязательный | Описание
----- | ----- | ----- | -----
`id` | **string** | Да, если не указан `link` | Идентификатор файла видео из облачного хранилища `media`. Файл необходимо предварительно выгрузить методом [Отправка медиаданных](../media/upload.md)
`link` | **string** | Да, если не указан `id` | Ссылка на файл видео. Ссылка должна быть доступна из Интернет. Допускается указывать ссылки только протоколов `HTTP` и `HTTPS`

Объект `audio`

Параметр | Тип | Обязательный | Описание
----- | ----- | ----- | -----
`id` | **string** | Да, если не указан `link` | Идентификатор файла аудио из облачного хранилища `media`. Файл необходимо предварительно выгрузить методом [Отправка медиаданных](../media/upload.md)
`link` | **string** | Да, если не указан `id` | Ссылка на файл аудио. Ссылка должна быть доступна из Интернет. Допускается указывать ссылки только протоколов `HTTP` и `HTTPS`

Объект `document`

Параметр | Тип | Обязательный | Описание
----- | ----- | ----- | -----
`id` | **string** | Да, если не указан `link` | Идентификатор файла документа из облачного хранилища `media`. Файл необходимо предварительно выгрузить методом [Отправка медиаданных](../media/upload.md)
`link` | **string** | Да, если не указан `id` | Ссылка на файл документа. Ссылка должна быть доступна из Интернет. Допускается указывать ссылки только протоколов `HTTP` и `HTTPS`

### Пример тела запроса {#request-example-body}

Отправка изображения. В примере файл изображения был предварительно [выгружен](../media/upload.md) в облачное хранилище `media` и получен идентификатор файла `bca567ba-0bd7-4211-8792-0c123fbd2716`:
```json
{
    "to": "79001234567",
    "type":  "image",
    "image": {
        "id": "bca567ba-0bd7-4211-8792-0c123fbd2716",
        "caption": "Green-API Logo"
    }
}
```

Отправка документа в группу по ссылке:
```json
{
    "recipient_type": "group",
    "to": "79001234567-1581234048",
    "type":  "document",
    "document": {
        "link": "https://storage.mysite.com/upload/green-api-presentation.pdf"
    }
}
```
## Ответ {#response}

При успешном ответе возвращается код HTTP `201`

### Поля ответа {#response-parameters}

Поле | Тип |  Описание
----- | ----- | -----
`messages` | **array** | Массив идентификаторов отправленных сообщений 


Массив `messages`

Поле | Тип |  Описание
----- | ----- | -----
`id ` | **string** | Идентификатор отправленного сообщения 

### Пример тела ответа {#response-example-body}

```
201 Created
```

```json
{
    "messages": [
        {
            "id": "1234"
        }
    ],
    "meta": {
        "api_status": "stable",
        "version": "2.0.1"
    }
}
```

### Ошибки {#errors}

Перечень общих для всех методов ошибок смотрите в разделе [Стандартные ошибки](../errors.md)

В случае ошибки возвращается код HTTP `400` с подробным описанием ошибки в теле ответа.

### Пример тела ответа с ошибкой {#response-example-body-error}

```json
{
    "errors": [
        {
            "code": 1,
            "details": "The file URL is not available",
            "title": "Файл по данному URL недоступен"
        }
    ],
    "meta": {
        "api_status": "stable",
        "version": "2.0.1"
    }
}
```

## Пример кода на Python  {#request-example-python}

```python
import requests

url = "https://api.green-api.com/v1/messages"

payload = "{\r\n    \"to\": \"79001234567\",\r\n    \"type\":  \"image\",\r\n    \"image\": {\r\n        \"id\": \"bca567ba-0bd7-4211-8792-0c123fbd2716\",\r\n        \"caption\": \"Green-API Logo\"\r\n    }\r\n}"
headers = {
  'Authorization': 'Bearer {{AuthToken}}',
  'Content-Type': 'application/json'
}

response = requests.request("POST", url, headers=headers, data = payload)

print(response.text.encode('utf8'))
```